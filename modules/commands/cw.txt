const puppeteer = require('puppeteer-core');
const fs = require('fs-extra');
const path = require('path');

module.exports.config = {
    name: "cw",
    version: "1.0.0",
    hasPermssion: 0,
    credits: "TatsuYTB",
    description: "Chá»¥p trang cÃ¡ nhÃ¢n Facebook",
    commandCategory: "Tiá»‡n Ã­ch",
    usages: ["cw"],
    cooldowns: 60,
    dependencies: { "puppeteer-core": "" }
};

module.exports.run = async function({ api, event }) {
    const facebookId = event.senderID;
    if (!facebookId) return api.sendMessage("ğƒğšÌƒ ğ±ğšÌ‰ğ² ğ«ğš ğ¥ğ¨Ì‚Ìƒğ¢!", event.threadID);

    api.sendMessage("ğ•ğ®ğ¢ ğ¥ğ¨Ì€ğ§ğ  ğœğ¡ğ¨Ì›Ì€...", event.threadID, async () => {
        const browser = await puppeteer.launch({
            executablePath: 'C:/Users/Administrator/Desktop/chromium/chromium.exe',
            headless: false,
            userDataDir: 'C:/Users/Administrator/AppData/Local/Chromium/User Data',
            args: ['--no-sandbox', '--disable-setuid-sandbox']
        });

        try {
            const page = await browser.newPage();

            await page.goto(`https://www.facebook.com/${facebookId}`, { waitUntil: 'networkidle2', timeout: 60000 });

            await page.setViewport({ width: 1920, height: 1080 });

            const screenshotPath = path.join(__dirname, 'screenshot.png');
            await page.screenshot({ path: screenshotPath });

            await browser.close();

            api.sendMessage({
                body: "ğ€Ì‰ğ§ğ¡ ğ­ğ«ğšğ§ğ  ğœğšÌ ğ§ğ¡ğšÌ‚ğ§ ğ…ğšğœğğ›ğ¨ğ¨ğ¤ ğœğ®Ì‰ğš ğ›ğšÌ£ğ§ ğğšÌ‚ğ²!",
                attachment: fs.createReadStream(screenshotPath)
            }, event.threadID);

            fs.unlinkSync(screenshotPath);
        } catch (error) {
            console.error('Error while taking screenshot:', error);
            await browser.close();
            api.sendMessage("ğƒğšÌƒ ğ±ğšÌ‰ğ² ğ«ğš ğ¥ğ¨Ì‚Ìƒğ¢!", event.threadID);
        }
    });
};
